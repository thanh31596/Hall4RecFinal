<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HallAgent4Rec Compact Framework</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            margin: 20px;
            background-color: #ffffff;
            color: #000000;
            font-size: 14px;
        }

        .framework-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: white;
            position: relative;
            padding: 20px;
        }

        .main-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
        }

        .vertical-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .component-box {
            border: 2px solid #2c3e50;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
            position: relative;
        }

        .item-set {
            width: 100px;
            height: 120px;
            border: 2px solid #34495e;
            border-radius: 10px;
            background: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 10px;
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            margin-bottom: 8px;
        }

        .item-icon {
            width: 18px;
            height: 18px;
            background: #3498db;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin: 0 auto;
        }

        .arrow {
            font-size: 24px;
            color: #2c3e50;
            margin: 0 10px;
        }

        .vertical-arrow {
            font-size: 20px;
            color: #2c3e50;
        }

        .phase-label {
            font-size: 12px;
            font-weight: bold;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .math-notation {
            font-style: italic;
            font-size: 11px;
            color: #2c3e50;
            margin-top: 3px;
        }

        .fusion-process {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .vector-box {
            width: 60px;
            height: 40px;
            border: 1px solid #27ae60;
            background: #e8f6e8;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            text-align: center;
        }

        .attention-circle {
            width: 50px;
            height: 50px;
            border: 2px solid #f39c12;
            background: #fff3cd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            text-align: center;
        }

        .hallucination-detection {
            background: #fde8e8;
            border-color: #e74c3c;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }

        .feedback-loop {
            border: 2px dashed #e74c3c;
            border-radius: 20px;
            padding: 5px;
            margin-top: 10px;
            background: rgba(231, 76, 60, 0.1);
        }

        .title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .small-text {
            font-size: 10px;
            color: #7f8c8d;
        }

        .compact-notation {
            font-size: 10px;
            font-style: italic;
            color: #2c3e50;
        }

        .legend {
            font-size: 11px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="framework-container">
        <div class="title">HallAgent4Rec Framework</div>
        
        <!-- Main Horizontal Flow -->
        <div class="main-flow">
            <!-- Item Set -->
            <div class="vertical-flow">
                <div class="item-set">
                    <div class="item-grid">
                        <div class="item-icon">üì±</div>
                        <div class="item-icon">üëï</div>
                        <div class="item-icon">üìö</div>
                        <div class="item-icon">üëû</div>
                        <div class="item-icon">üíª</div>
                        <div class="item-icon">üé¨</div>
                        <div class="item-icon">‚òï</div>
                        <div class="item-icon">üöó</div>
                        <div class="item-icon">üéß</div>
                    </div>
                    <div class="small-text">Item Set<br><em>x<sub>j</sub> ‚àà ‚Ñù<sup>f</sup></em></div>
                </div>
                <div class="small-text">User-Item Matrix<br><em>R ‚àà ‚Ñù<sup>n√óm</sup></em></div>
            </div>

            <div class="arrow">‚Üí</div>

            <!-- Phase 1: Dual Representation Learning -->
            <div class="component-box">
                <div class="phase-label">Phase 1</div>
                <div style="font-weight: bold; margin-bottom: 8px;">Dual Learning</div>
                
                <div class="fusion-process">
                    <div class="vector-box">
                        <div>u<sup>cf</sup><sub>i</sub></div>
                    </div>
                    <div class="attention-circle">
                        œÜ
                    </div>
                    <div class="vector-box">
                        u<sup>gen</sup><sub>i</sub>
                    </div>
                </div>
                
                <div class="vertical-arrow">‚Üì</div>
                <div class="compact-notation">u<sub>i</sub> = œÜh<sup>gen</sup><sub>i</sub> + (1-œÜ)h<sup>cf</sup><sub>i</sub></div>
                
                <div style="margin-top: 8px; display: flex; gap: 5px; justify-content: center;">
                    <div style="font-size: 10px; border: 1px solid #3498db; padding: 2px 4px; border-radius: 3px;">A</div>
                    <div style="font-size: 10px; border: 1px solid #3498db; padding: 2px 4px; border-radius: 3px;">B</div>
                </div>
            </div>

            <div class="arrow">‚Üí</div>

            <!-- Phase 2: Scoring -->
            <div class="component-box">
                <div class="phase-label">Phase 2</div>
                <div style="font-weight: bold; margin-bottom: 8px;">Hybrid Scoring</div>
                <div class="compact-notation">≈ï<sub>ij</sub> = g(u<sub>i</sub><sup>T</sup>Ax<sub>j</sub> + u<sub>i</sub><sup>T</sup>BŒ∏<sub>j</sub>)</div>
                
                <div class="vertical-arrow">‚Üì</div>
                
                <div style="background: #fdf2e8; padding: 5px; border-radius: 3px; margin-top: 5px;">
                    <div style="font-size: 10px;">LLM Generation</div>
                </div>
            </div>

            <div class="arrow">‚Üí</div>

            <!-- Phase 3: Hallucination Detection -->
            <div class="component-box">
                <div class="phase-label">Phase 3</div>
                <div style="font-weight: bold; margin-bottom: 8px;">Hallucination Detection</div>
                
                <div class="hallucination-detection">
                    <div style="font-size: 11px; margin-bottom: 5px;">h(ƒµ) = {0,1}</div>
                    <div class="vertical-arrow">‚Üì</div>
                    <div style="font-size: 10px;">j* = argmax[Œ±¬∑sim + (1-Œ±)¬∑≈ï]</div>
                </div>
                
                <div class="compact-notation">Œ± = s<sub>genre</sub> √ó (1-s<sub>exp</sub>)</div>
            </div>

            <div class="arrow">‚Üí</div>

            <!-- User -->
            <div class="vertical-flow">
                <div class="user-icon">üë§</div>
                <div class="small-text">User <em>u</em></div>
                <div class="vertical-arrow">‚Üë</div>
                <div style="display: flex; gap: 5px; margin-top: 5px;">
                    <div class="item-icon">üìö</div>
                    <div class="item-icon">üéß</div>
                    <div class="item-icon">‚òï</div>
                </div>
                <div class="small-text">Recommendations</div>
            </div>
        </div>

        <!-- Feedback Loop -->
        <div class="feedback-loop">
            <div style="text-align: center; font-size: 11px; font-weight: bold; margin-bottom: 5px;">
                Online Parameter Updates
            </div>
            <div style="display: flex; justify-content: space-around; font-size: 10px;">
                <span>Œ∏<sub>j</sub><sup>(t+1)</sup></span>
                <span>b<sub>j</sub><sup>(t+1)</sup></span>
                <span>w<sup>(t+1)</sup></span>
            </div>
            <div style="text-align: center; margin-top: 5px;">
                <div style="border: 2px dashed #e74c3c; border-radius: 50%; width: 30px; height: 30px; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: #e74c3c;">
                    ‚Üª
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <strong>Key:</strong> 
            u<sup>cf</sup><sub>i</sub>: CF vector, 
            u<sup>gen</sup><sub>i</sub>: Personality vector, 
            œÜ: Attention weight, 
            A,B: Transfer matrices, 
            Œ∏<sub>j</sub>: Online factors
        </div>
    </div>
</body>
</html>